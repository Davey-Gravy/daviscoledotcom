<!DOCTYPE html>
<html lang="en">
  <head>
    {{ partial "head.html" . }}
  </head>
  <body>
    <div class="site-wrapper">
      <!-- Mobile menu button -->
      <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Toggle menu">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>

      <!-- Sidebar overlay for mobile -->
      <div class="sidebar-overlay" onclick="toggleSidebar()"></div>

      {{ partial "sidebar.html" . }}

      <main class="main-content">
        <div class="content-wrapper{{ if .IsHome }} home{{ end }}">
          {{ block "main" . }}{{ end }}
        </div>
        <footer class="site-footer">
          {{ partial "footer.html" . }}
        </footer>
      </main>
    </div>

    <!-- KaTeX auto-render -->
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        if (typeof renderMathInElement !== 'undefined') {
          renderMathInElement(document.body, {
            delimiters: [
              { left: "$", right: "$", display: false },
              { left: "$$", right: "$$", display: true },
            ],
          });
        }
      });
    </script>

    <!-- Theme toggle and sidebar scripts -->
    <script>
      // Theme toggle
      function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        html.setAttribute('data-theme', next);
        localStorage.setItem('theme', next);
      }

      // Listen for system preference changes
      window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!localStorage.getItem('theme')) {
          document.documentElement.setAttribute('data-theme', e.matches ? 'dark' : 'light');
        }
      });

      // Sidebar toggle for mobile
      function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        const overlay = document.querySelector('.sidebar-overlay');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('active');
        document.body.style.overflow = sidebar.classList.contains('open') ? 'hidden' : '';
      }

      // Close sidebar on escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar.classList.contains('open')) {
            toggleSidebar();
          }
        }
      });

      // Close sidebar when clicking a nav link (mobile)
      document.querySelectorAll('.sidebar .nav-link:not(.nav-section-toggle)').forEach(link => {
        link.addEventListener('click', () => {
          const sidebar = document.querySelector('.sidebar');
          if (sidebar.classList.contains('open')) {
            toggleSidebar();
          }
        });
      });
    </script>
  </body>
</html>
